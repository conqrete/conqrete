#!/bin/bash

# Info
echo "üîπ Running generate-project.sh"

# Searching Tuist
echo ""
echo "üîπ [1/4] Searching for Tuist"

export TUIST=$(which tuist)
if ! command -v $TUIST &> /dev/null; then
    echo "‚ùå Tuist not found"
    exit 1
else
    echo "‚úÖ Found Tuist at $TUIST"
fi

# 2 Fetch Dependencies
echo ""
echo "üîπ [2/4] Fetching dependencies"

export PROJECT_DIR=.
$TUIST fetch -p $PROJECT_DIR

echo "‚úÖ Fetching dependencies completed"

# Get Project Version
echo ""
echo "üîπ [3/4] Getting current project version..."

export CURRENT_PROJECT_VERSION=$(cat ./.current-project-version)

echo "‚úÖ Current project version is $CURRENT_PROJECT_VERSION"

# Generate Project
echo ""
echo "üîπ [4/4] Generating Xcode project and workspace..."

export TUIST_PROJECT_VERSION=$CURRENT_PROJECT_VERSION && $TUIST generate -p $PROJECT_DIR --no-open

echo "‚úÖ Generating Xcode project and workspace completed"

# Completed
echo ""
echo "‚úÖ generate-project.sh completed"
